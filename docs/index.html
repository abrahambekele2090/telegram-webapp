<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<!-- üîÅ CHANGE TITLE PER PROJECT -->
<title>Secure Notes</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
/* ======================
   üé® THEME VARIABLES
   (REUSABLE TEMPLATE)
====================== */
:root {
  --bg: #ffffff;
  --text: #111111;
  --muted: #666666;
  --border: #e5e5e5;
  --primary: #2aabee;
  --radius: 14px;
}

/* ======================
   BASE LAYOUT
====================== */
body {
  margin: 0;
  background: var(--bg);
  font-family: system-ui, -apple-system;
  color: var(--text);
}

.app {
  max-width: 420px;
  margin: auto;
  padding: 20px;
}

/* ======================
   TYPOGRAPHY
====================== */
h1 {
  margin: 0 0 6px;
  font-size: 22px;
}

p {
  margin: 0 0 18px;
  color: var(--muted);
  font-size: 14px;
}

/* ======================
   INPUTS
====================== */
input, textarea {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  box-sizing: border-box;
}

textarea {
  height: 110px;
  resize: none;
}

/* ======================
   BUTTONS
====================== */
button {
  width: 100%;
  padding: 14px;
  margin-top: 12px;
  border: none;
  border-radius: var(--radius);
  background: var(--primary);
  color: white;
  font-size: 16px;
}

button.secondary {
  background: #e0e0e0;
  color: #000;
}

/* ======================
   NOTES
====================== */
.note {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 12px;
  margin-top: 12px;
  background: #fafafa;
}

.hidden { display: none; }
</style>
</head>

<body>
<div class="app">

<!-- üîê LOCK SCREEN -->
<div id="lock">
  <h1>üîê Locked</h1>
  <p>Enter your PIN</p>
  <input id="pinInput" type="password" autofocus>
  <button onclick="unlock()">Unlock</button>
</div>

<!-- üóí MAIN APP -->
<div id="main" class="hidden">
  <h1>üóí Notes</h1>
  <p>Your private notes</p>

  <input id="search" placeholder="Search notes..." oninput="render()">

  <textarea id="text" placeholder="Write a note..."></textarea>
  <button onclick="add()">‚ûï Add note</button>

  <div id="notes"></div>

  <button class="secondary" onclick="backup()">üì¶ Backup</button>
</div>

</div>

<script>
/* ======================
   TELEGRAM INIT
====================== */
const tg = Telegram.WebApp;
tg.ready();
tg.expand();

/* Dark mode sync */
if (tg.colorScheme === "dark") {
  document.documentElement.style.setProperty("--bg", "#0e1621");
  document.documentElement.style.setProperty("--text", "#ffffff");
  document.documentElement.style.setProperty("--border", "#2a2a2a");
  document.documentElement.style.setProperty("--muted", "#9aa0a6");
}

/* ======================
   SECURITY (PIN HASH)
====================== */
async function hash(text) {
  const buf = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(text)
  );
  return [...new Uint8Array(buf)]
    .map(b => b.toString(16).padStart(2, "0"))
    .join("");
}

(async () => {
  if (!localStorage.getItem("pin")) {
    const p = prompt("Create a PIN");
    localStorage.setItem("pin", await hash(p));
  }
})();

async function unlock() {
  const h = await hash(pinInput.value);
  if (h === localStorage.getItem("pin")) {
    lock.classList.add("hidden");
    main.classList.remove("hidden");
    text.focus();
  }
}

/* ======================
   NOTES LOGIC
====================== */
let notes = JSON.parse(localStorage.getItem("notes") || "[]");

function save() {
  localStorage.setItem("notes", JSON.stringify(notes));
  render();
}

function add() {
  if (!text.value.trim()) return;
  notes.unshift({ text: text.value });
  text.value = "";
  save();
}

function render() {
  notesDiv.innerHTML = "";
  const q = search.value.toLowerCase();

  notes
    .filter(n => n.text.toLowerCase().includes(q))
    .forEach((n, i) => {
      const d = document.createElement("div");
      d.className = "note";
      d.innerHTML = `
        ${n.text}
        <button class="secondary" onclick="del(${i})">‚ùå Delete</button>
      `;
      notesDiv.appendChild(d);
    });
}

function del(i) {
  notes.splice(i, 1);
  save();
}

/* ======================
   BACKUP
====================== */
function backup() {
  tg.sendData(JSON.stringify({ event: "export", notes }));
  alert("Backup sent to bot");
}

const notesDiv = document.getElementById("notes");
render();
</script>

</body>
</html>
